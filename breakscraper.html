<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Break Scraper</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">Break Scraper</h2>
       
        
        <h2 class="mb-4">Listings</h2>
        <textarea id="json-input" class="form-control mb-3" rows="10" placeholder='Paste JSON here'></textarea>
        <button class="btn btn-primary" onclick="processJson()">Generate Table</button>
        <div id="break-details" class="mb-4"></div>
        <h4 class="mt-4">Total Sales: $<span id="total-sales">0</span></h4>
        <h4>Average Sale Price per Filled Spot: $<span id="average-price">0</span></h4>
        <table class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Listing Title</th>
                    <th>Price Amount</th>
                </tr>
            </thead>
            <tbody id="table-body">
                <!-- Data will be inserted here -->
            </tbody>
        </table>
        
    </div>
    
    <script>
        function processJson() {
            const input = document.getElementById("json-input").value;
            try {
                const jsonData = JSON.parse(input);
                const breakData = jsonData?.data?.getBreak;
                const spots = breakData?.spots || [];
                const tableBody = document.getElementById("table-body");
                const breakDetails = document.getElementById("break-details");
                const totalSalesEl = document.getElementById("total-sales");
                const averagePriceEl = document.getElementById("average-price");
                
                tableBody.innerHTML = ""; // Clear previous data
                breakDetails.innerHTML = `
                    <p><strong>Title:</strong> ${breakData?.title || "N/A"}</p>
                    <p><strong>Description:</strong> ${breakData?.description || "N/A"}</p>
                    <p><strong>Total Spots:</strong> ${breakData?.totalBreakSpots || "N/A"}</p>
                    <p><strong>Filled Spots:</strong> ${breakData?.filledBreakSpots || "N/A"}</p>
                `;
                
                let totalSales = 0;
                
                spots.forEach(spot => {
                    const listing = spot.listing;
                    if (listing && listing.title && listing.price && listing.price.amount !== undefined) {
                        const formattedPrice = (listing.price.amount / 100).toFixed(0); // Drop last two zeros
                        totalSales += parseInt(formattedPrice);
                        
                        const row = `<tr>
                                        <td>${listing.title}</td>
                                        <td>$${formattedPrice}</td>
                                    </tr>`;
                        tableBody.innerHTML += row;
                    }
                });
                
                totalSalesEl.textContent = totalSales.toLocaleString();
                const filledSpots = breakData?.filledBreakSpots || 1;
                const averagePrice = filledSpots > 0 ? (totalSales / filledSpots).toFixed(2) : "0";
                averagePriceEl.textContent = averagePrice;
            } catch (error) {
                alert("Invalid JSON format. Please enter valid JSON.");
            }
        }
    </script>
</body>
</html>
